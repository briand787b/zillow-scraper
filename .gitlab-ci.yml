image: docker:latest

services:
  - docker:dind

before_script:
  - apk update && apk add make docker-compose

show_build_fs:
  stage: build
  script:
    - ls chrome-react-app

build_backend:
  stage: build
  script:
    - docker-compose build backend-go

build_chrome_app:
  stage: build
  script:
    - docker-compose run --no-deps -w /usr/local/src chrome-app npm install && npm run build
  artifacts:
    untracked: false
    expire_in: 30 days
    paths:
      - chrome-react-app/build

# test_backend:
#   stage: test
#   script:
#     - make test-backend

# test_chrome_app:
#   stage: test
#   script:
#     - make test-chrome-app

test:
  stage: test
  script:
    - make test

show_test_fs:
  stage: test
  script:
   - ls chrome-react-app